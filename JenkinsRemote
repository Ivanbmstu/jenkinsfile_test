//version 0.0.1
def gradleTasks = ''
def UUID_DIR = UUID.randomUUID().toString()

String deployRepo, repoSlug, projKey, branch, version

pipeline {
  agent {
    label {
      label 'local-jenkins'
      customWorkspace UUID_DIR
    }
  }
  parameters {
    string(name: 'testb', description: 'MASTER FROM MASTER 2', defaultValue: 'MASTERFROMMASTER')
    string(name: 'gitUrl', description: 'test', defaultValue: 'master')
    string(name: 'branch', description: 'test', defaultValue: 'master')
  }

  options {
    buildDiscarder(logRotator(numToKeepStr: '15', artifactNumToKeepStr: '1'))
    timeout(time: 30, unit: 'MINUTES')
    skipStagesAfterUnstable()
    timestamps()
  }

  stages {
    stage('git repo') {
      steps {
        script {
          git branch: params.branch, url: params.gitUrl
        }
      }
    }
    stage('define build method') {
      steps {
        script {
          sh "echo 'hello ${params.testb} remote jenkins'"
          deployRepo  = ''
          gradleTasks = 'build'

        }
      }
    }
    stage('build') {
      steps {
          script {
             sh './gradlew clean build --info'
          }
      }
    }
  }
}

def markAsUnstable() {
  currentBuild.result='UNSTABLE'
}
def notifyBitbucketWithState(String state) {
  if('SUCCESS' == state || 'FAILED' == state) {
    currentBuild.result = state         // Set result of currentBuild !Important!
  }
  notifyBitbucket()
}
